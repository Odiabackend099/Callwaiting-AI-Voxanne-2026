{
  "meta": {
    "project": "Voxanne AI",
    "date": "2026-02-20",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "Voxanne AI is a production-ready AI receptionist platform for healthcare practices that automates inbound/outbound voice interactions, appointment booking, and prepaid billing. The product couples a Next.js frontend with Supabase-backed telemetry, Stripe wallet top-ups, and managed telephony integrations (Twilio/Vapi).",
  "core_goals": [
    "Provide reliable AI-driven call handling that books appointments, qualifies leads, and writes an auditable Golden Record for every call.",
    "Enforce a real-time prepaid billing engine (reserve → commit → kill-switch) to prevent revenue leakage and ensure zero-debt policy.",
    "Surface operational dashboards (calls, appointments, wallet) for actionable analytics and rapid troubleshooting.",
    "Enable non-technical customers to manage phone numbers, configure AI agents, and verify outbound caller IDs through the UI.",
    "Maintain security and multi-tenant isolation via JWT auth, Supabase RLS, and hardened backend functions."
  ],
  "features": [
    {
      "name": "User Authentication",
      "description": "Email/password login with Google SSO, support for password recovery and account sign-up flows; JWT-based auth used to protect dashboard routes.",
      "user_flows": [
        "Navigate to /login -> Enter email address in login form -> Enter password in login form -> Click Sign In button to authenticate -> See /dashboard",
        "Navigate to /login -> Click Sign in with Google for SSO -> Complete Google consent -> Be redirected to /dashboard",
        "Navigate to /login -> Click Forgot Password to reset -> Enter email in reset form -> See 'password reset email sent' confirmation",
        "Navigate to /sign-in -> Click Create new account link -> Fill sign up form -> Submit -> See email verification required message",
        "Navigate to /login -> Enter invalid email format -> Enter password -> Click Sign In button to authenticate -> See validation error for email"
      ]
    },
    {
      "name": "Dashboard Analytics",
      "description": "Real-time overview of calls, appointments, leads, recent activity and sentiment with drilldown to detail rows.",
      "user_flows": [
        "Navigate to /dashboard -> See total calls handled today displayed -> See appointments booked count -> See average sentiment score",
        "Navigate to /dashboard -> Click on recent activity item -> See detailed call record (cost_cents, appointment_id, tools_used)",
        "Navigate to /dashboard -> API GET /api/calls-dashboard/stats returns aggregated metrics -> Observe total_calls and average_sentiment",
        "Navigate to /dashboard -> Observe missing analytics widgets due to auth/session error -> See error banner asking user to re-authenticate"
      ]
    },
    {
      "name": "Call Logs Management",
      "description": "Browse and manage inbound/outbound call records with search, filters, playback, transcripts, follow-up SMS, and deletion.",
      "user_flows": [
        "Navigate to /dashboard/calls -> Search calls by caller name or phone number -> See filtered list of matching calls -> Click a call to open details",
        "Navigate to /dashboard/calls -> Filter calls by status (completed) -> Filter calls by date range -> See results list update",
        "Navigate to /dashboard/calls -> Click Play recording inline -> Recording player loads and plays audio -> See transcript area populated",
        "Navigate to /dashboard/calls -> Open call details -> Click Send SMS follow-up -> Enter message -> Click Send -> See success toast",
        "Navigate to /dashboard/calls -> Select call -> Click Delete call record -> Confirm deletion -> See call removed from list",
        "Navigate to /dashboard/calls -> Enter malformed phone string in search -> Click Search -> See validation/error message and no results"
      ]
    },
    {
      "name": "Appointment Management",
      "description": "View, filter, reschedule and cancel appointments booked by AI agents; appointments link back to the call Golden Record and support calendar sync.",
      "user_flows": [
        "Navigate to /dashboard/appointments -> View all appointments with pagination -> Click an appointment to view details -> See linked call data",
        "Navigate to /dashboard/appointments -> Filter by status (pending) -> See filtered appointments -> Click appointment -> Click Reschedule -> Submit new date -> See updated status",
        "Navigate to /dashboard/appointments -> Click an appointment -> Click Cancel -> Confirm cancellation -> See appointment status updated to cancelled",
        "Navigate to /dashboard/appointments -> Attempt to reschedule with invalid date -> Click Save -> See validation error and no change"
      ]
    },
    {
      "name": "AI Agent Configuration",
      "description": "Create and edit inbound/outbound AI voice agents: name, system prompt, voice selection (preview), greeting, max duration, phone assignment and test calls.",
      "user_flows": [
        "Navigate to /dashboard/agent-config -> Switch between inbound and outbound agent tabs -> Select agent to edit -> Edit agent name and description -> Click Save -> See 'saved' confirmation",
        "Navigate to /dashboard/agent-config -> Open Voice selection -> Select voice -> Click preview -> Hear sample playback -> Click Save",
        "Navigate to /dashboard/agent-config -> Assign phone number to agent from dropdown -> Click Save -> See number displayed on agent card",
        "Navigate to /dashboard/agent-config -> Click Test to trigger test call -> Confirm test call started -> Receive test call via Vapi",
        "Navigate to /dashboard/agent-config -> Enter overly long system prompt -> Click Save -> See validation error preventing save"
      ]
    },
    {
      "name": "Knowledge Base Management",
      "description": "Upload and manage PDFs and text documents for agents to reference during calls; track processing status and organize entries.",
      "user_flows": [
        "Navigate to /dashboard/knowledge-base -> Drag and drop a PDF into upload area -> See file upload progress -> See 'processing' status then 'ready' when complete",
        "Navigate to /dashboard/knowledge-base -> Click Add manual text entry -> Enter title and content -> Click Save -> See new KB item in list",
        "Navigate to /dashboard/knowledge-base -> Select item -> Click Edit -> Change category -> Click Save -> See updated category displayed",
        "Navigate to /dashboard/knowledge-base -> Select item -> Click Delete -> Confirm deletion -> See item removed from list",
        "Navigate to /dashboard/knowledge-base -> Upload unsupported file type -> See validation error and upload blocked"
      ]
    },
    {
      "name": "Wallet and Billing",
      "description": "Prepaid wallet showing GBP balance, transaction history, top-up via Stripe (minimum £25), auto-recharge and billing debug tools.",
      "user_flows": [
        "Navigate to /dashboard/wallet -> See current balance in GBP and balance trend chart -> See transaction history entries",
        "Navigate to /dashboard/wallet -> Click Top Up -> Choose £25 preset -> Complete Stripe Checkout -> See wallet balance increased",
        "Navigate to /dashboard/wallet -> Click Set auto-recharge -> Enter threshold and payment method -> Click Save -> See auto-recharge enabled",
        "Navigate to /dashboard/wallet -> Click Download transaction statements -> File downloads -> Open CSV and verify entries",
        "Navigate to /dashboard/wallet -> Click Top Up -> Enter amount below minimum (e.g. £5) -> Click Continue -> See validation error and prevented checkout"
      ]
    },
    {
      "name": "Phone Settings & Managed Numbers",
      "description": "Buy and manage inbound phone numbers, configure AI forwarding modes, ring times, and manage outbound caller IDs.",
      "user_flows": [
        "Navigate to /dashboard/phone-settings -> Click Buy new phone number -> Select country/area -> Complete purchase -> See new number appear in list",
        "Navigate to /dashboard/phone-settings -> Select a managed number -> Set AI forwarding to 'total AI' -> Configure forwarding ring time -> Click Save -> See forwarding mode active",
        "Navigate to /dashboard/phone-settings -> Select number -> Click Delete -> Confirm deletion -> See number removed and DB constraint prevents duplicate buys",
        "Navigate to /dashboard/phone-settings -> Attempt to buy second managed number when org already has one -> See UI/DB constraint error preventing purchase",
        "Navigate to /dashboard/phone-settings -> Attempt purchase with insufficient balance -> See billing error and purchase blocked"
      ]
    },
    {
      "name": "Test Agent",
      "description": "Test configured AI agents in-browser using text or browser-based voice to validate agent responses, transcripts and quality before production use.",
      "user_flows": [
        "Navigate to /dashboard/test -> Type message to test agent text response -> Press Send -> See agent reply in chat window",
        "Navigate to /dashboard/test -> Click microphone to start voice test -> Grant microphone permission -> See real-time transcript during call -> Hear agent voice response",
        "Navigate to /dashboard/test -> Click Stop test call -> See call session end and final transcript displayed",
        "Navigate to /dashboard/test -> Start voice test with network outage -> See error banner and test call aborted"
      ]
    },
    {
      "name": "Onboarding Intake Form",
      "description": "Collect company info, greeting script, voice preference and optional pricing PDF at onboarding `/start`; store submission, send confirmation email and support notification.",
      "user_flows": [
        "Navigate to /start -> Fill company name, email, phone (E.164), greeting script and choose voice -> Attach optional pricing PDF -> Click Submit -> See success message and confirmation email sent",
        "Navigate to /start -> Fill form but omit required greeting_script -> Click Submit -> See validation error for missing greeting_script and submission blocked",
        "Navigate to /start -> Fill form with invalid phone format -> Click Submit -> See phone format validation error"
      ]
    },
    {
      "name": "Verified Caller ID",
      "description": "Verify outbound caller IDs via Twilio pre-check and validation request flows; UI shows validation code in blue box and supports remove/confirm workflows.",
      "user_flows": [
        "Navigate to /dashboard/verified-caller-id -> Enter phone number in E.164 -> Click Start Verification -> Backend pre-check finds number already verified in Twilio -> See blue box 'Phone number is already verified!' -> See green verified status",
        "Navigate to /dashboard/verified-caller-id -> Enter phone number in E.164 -> Click Start Verification -> Backend pre-check finds not verified -> Blue box displays 6-digit validation code -> Receive Twilio call -> Enter code on phone keypad -> Click Verify & Complete Setup -> See verified status",
        "Navigate to /dashboard/verified-caller-id -> Click Remove Verification -> Confirm deletion -> See verified status removed",
        "Navigate to /dashboard/verified-caller-id -> Skip pre-check and call verification -> Click Verify & Complete Setup -> See error indicating pre-check was skipped and verification failed"
      ]
    },
    {
      "name": "Webhook Monitoring & Debug APIs",
      "description": "APIs and health endpoints for verifying Stripe/webhook delivery, billing debug, and webhook processed counts used by operators for troubleshooting.",
      "user_flows": [
        "Call GET /api/webhook-verification/health -> Observe processed counts and ratio -> See health OK",
        "Call GET /api/webhook-verification/payment/:paymentIntentId -> Provide paymentIntentId -> See webhook processing details and wallet credit status",
        "Call GET /api/billing-debug/:callId -> Provide callId -> Observe billing trace for reserve/commit and credit_transactions entry",
        "Call GET /api/webhook-verification/recent-transactions -> Observe recent webhook deliveries -> See failed delivery entries and error reasons"
      ]
    }
  ],
  "code_summary": {
    "version": "2",
    "type": "frontend",
    "tech_stack": [
      "TypeScript",
      "Next.js 14.2.14",
      "React 18.3.1",
      "Tailwind CSS 3.4.1",
      "Supabase",
      "Framer Motion",
      "Zustand",
      "SWR",
      "Radix UI",
      "Recharts"
    ],
    "routes": [
      {
        "path": "/",
        "file": "src/app/page.tsx",
        "auth_required": false,
        "description": "Landing page with hero section, features, testimonials, pricing, and FAQ"
      },
      {
        "path": "/login",
        "file": "src/app/login/page.tsx",
        "auth_required": false,
        "description": "Email/password login page with Google SSO option"
      },
      {
        "path": "/sign-in",
        "file": "src/app/sign-in/page.tsx",
        "auth_required": false,
        "description": "Sign-in page that redirects to login"
      },
      {
        "path": "/about",
        "file": "src/app/about/page.tsx",
        "auth_required": false,
        "description": "About Voxanne AI company information"
      },
      {
        "path": "/contact-sales",
        "file": "src/app/contact-sales/page.tsx",
        "auth_required": false,
        "description": "Sales inquiry and contact form"
      },
      {
        "path": "/support",
        "file": "src/app/support/page.tsx",
        "auth_required": false,
        "description": "Support and help center page"
      },
      {
        "path": "/careers",
        "file": "src/app/careers/page.tsx",
        "auth_required": false,
        "description": "Careers and job listings page"
      },
      {
        "path": "/press-kit",
        "file": "src/app/press-kit/page.tsx",
        "auth_required": false,
        "description": "Press kit and media resources"
      },
      {
        "path": "/privacy",
        "file": "src/app/privacy/page.tsx",
        "auth_required": false,
        "description": "Privacy policy page"
      },
      {
        "path": "/terms",
        "file": "src/app/terms/page.tsx",
        "auth_required": false,
        "description": "Terms of service page"
      },
      {
        "path": "/dashboard",
        "file": "src/app/dashboard/page.tsx",
        "auth_required": true,
        "description": "Main dashboard with analytics, recent activity, and key metrics"
      },
      {
        "path": "/dashboard/calls",
        "file": "src/app/dashboard/calls/page.tsx",
        "auth_required": true,
        "description": "Call logs with filtering, search, recording playback, and transcripts"
      },
      {
        "path": "/dashboard/appointments",
        "file": "src/app/dashboard/appointments/page.tsx",
        "auth_required": true,
        "description": "Appointment management, booking history, and calendar sync"
      },
      {
        "path": "/dashboard/leads",
        "file": "src/app/dashboard/leads/page.tsx",
        "auth_required": true,
        "description": "Lead management with AI scoring and contact tracking"
      },
      {
        "path": "/dashboard/agent-config",
        "file": "src/app/dashboard/agent-config/page.tsx",
        "auth_required": true,
        "description": "Configure inbound and outbound AI voice agents"
      },
      {
        "path": "/dashboard/knowledge-base",
        "file": "src/app/dashboard/knowledge-base/page.tsx",
        "auth_required": true,
        "description": "Upload and manage knowledge base documents for AI agents"
      },
      {
        "path": "/dashboard/phone-settings",
        "file": "src/app/dashboard/phone-settings/page.tsx",
        "auth_required": true,
        "description": "Phone number management, AI forwarding, caller ID verification"
      },
      {
        "path": "/dashboard/wallet",
        "file": "src/app/dashboard/wallet/page.tsx",
        "auth_required": true,
        "description": "Billing wallet with balance, transaction history, and top-ups"
      },
      {
        "path": "/dashboard/test",
        "file": "src/app/dashboard/test/page.tsx",
        "auth_required": true,
        "description": "Test AI agent with web chat or voice call interface"
      },
      {
        "path": "/dashboard/settings",
        "file": "src/app/dashboard/settings/page.tsx",
        "auth_required": true,
        "description": "Account settings and notification preferences"
      },
      {
        "path": "/dashboard/inbound-config",
        "file": "src/app/dashboard/inbound-config/page.tsx",
        "auth_required": true,
        "description": "Twilio integration setup for inbound calls"
      },
      {
        "path": "/dashboard/verified-caller-id",
        "file": "src/app/dashboard/verified-caller-id/page.tsx",
        "auth_required": true,
        "description": "Verify outbound caller IDs via phone verification"
      },
      {
        "path": "/dashboard/escalation-rules",
        "file": "src/app/dashboard/escalation-rules/page.tsx",
        "auth_required": true,
        "description": "Configure call escalation rules and priorities"
      }
    ],
    "features": [
      {
        "name": "User Authentication",
        "description": "Email/password login, Google SSO, MFA enrollment, password recovery, email verification",
        "files": [
          "src/app/login/page.tsx",
          "src/app/(auth)/sign-up/page.tsx",
          "src/contexts/AuthContext.tsx",
          "src/components/auth/MFAEnrollment.tsx",
          "src/components/auth/SSOLogin.tsx"
        ],
        "entry_route": "/login",
        "user_interactions": [
          "Enter email address in login form",
          "Enter password in login form",
          "Click Sign In button to authenticate",
          "Click Sign in with Google for SSO",
          "Click Forgot Password to reset",
          "Create new account with sign up form"
        ],
        "api_calls": [
          {
            "method": "POST",
            "endpoint": "/api/auth/token"
          },
          {
            "method": "POST",
            "endpoint": "/api/auth/logout"
          }
        ],
        "auth_required": false
      },
      {
        "name": "Dashboard Analytics",
        "description": "Real-time overview of calls, appointments, leads, recent activity, and sentiment analysis",
        "files": [
          "src/app/dashboard/page.tsx",
          "src/components/dashboard/HotLeadDashboard.tsx",
          "src/components/dashboard/ClinicalPulse.tsx"
        ],
        "entry_route": "/dashboard",
        "user_interactions": [
          "View total calls handled today",
          "View appointments booked count",
          "See hot lead alerts and activity feed",
          "Monitor average sentiment score",
          "Click on recent activity items for details"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "/api/calls-dashboard/stats"
          },
          {
            "method": "GET",
            "endpoint": "/api/analytics/recent-activity"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Call Logs Management",
        "description": "View all inbound and outbound calls with search, filters, recording playback, and transcripts",
        "files": [
          "src/app/dashboard/calls/page.tsx",
          "src/components/RecordingPlayer.tsx"
        ],
        "entry_route": "/dashboard/calls",
        "user_interactions": [
          "Search calls by caller name or phone number",
          "Filter calls by status (completed, missed, transferred)",
          "Filter calls by date range",
          "Play call recordings inline",
          "View full call transcripts",
          "Send SMS follow-up to callers",
          "Delete call records"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "/api/calls-dashboard"
          },
          {
            "method": "GET",
            "endpoint": "/api/calls-dashboard/:callId"
          },
          {
            "method": "DELETE",
            "endpoint": "/api/calls/:id"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Appointment Management",
        "description": "View and manage appointments booked by AI agents with calendar sync and status tracking",
        "files": [
          "src/app/dashboard/appointments/page.tsx"
        ],
        "entry_route": "/dashboard/appointments",
        "user_interactions": [
          "View all appointments with pagination",
          "Filter by status (pending, confirmed, completed, no-show)",
          "Filter by date range",
          "Click to view appointment details",
          "Reschedule or cancel appointments",
          "View linked call data"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "/api/appointments"
          },
          {
            "method": "PATCH",
            "endpoint": "/api/appointments/:id"
          },
          {
            "method": "DELETE",
            "endpoint": "/api/appointments/:id"
          }
        ],
        "auth_required": true
      },
      {
        "name": "AI Agent Configuration",
        "description": "Configure inbound and outbound AI voice agents with system prompt, voice selection, and phone number assignment",
        "files": [
          "src/app/dashboard/agent-config/page.tsx",
          "src/components/VoiceSelector.tsx",
          "src/lib/prompt-templates.ts",
          "src/lib/store/agentStore.ts"
        ],
        "entry_route": "/dashboard/agent-config",
        "user_interactions": [
          "Switch between inbound and outbound agent tabs",
          "Edit agent name and description",
          "Choose or customize system prompt",
          "Select voice from 60+ options with preview",
          "Set first message greeting",
          "Set max call duration",
          "Assign phone number to agent",
          "Click Save to sync configuration to Vapi",
          "Click Test to trigger test call"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "/api/agents"
          },
          {
            "method": "POST",
            "endpoint": "/api/agents"
          },
          {
            "method": "GET",
            "endpoint": "/api/voices"
          },
          {
            "method": "POST",
            "endpoint": "/api/agents/test-call"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Knowledge Base Management",
        "description": "Upload PDFs and text documents for AI agents to reference during calls",
        "files": [
          "src/app/dashboard/knowledge-base/page.tsx"
        ],
        "entry_route": "/dashboard/knowledge-base",
        "user_interactions": [
          "Upload PDF or text files via drag and drop",
          "Add manual text entries",
          "Organize by category",
          "Edit or delete knowledge base items",
          "View file processing status"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "/api/knowledge-base"
          },
          {
            "method": "POST",
            "endpoint": "/api/knowledge-base"
          },
          {
            "method": "POST",
            "endpoint": "/api/knowledge-base/upload"
          },
          {
            "method": "DELETE",
            "endpoint": "/api/knowledge-base/:id"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Wallet and Billing",
        "description": "Prepaid credit wallet with balance tracking, transaction history, and Stripe top-ups",
        "files": [
          "src/app/dashboard/wallet/page.tsx"
        ],
        "entry_route": "/dashboard/wallet",
        "user_interactions": [
          "View current balance in GBP",
          "See balance trend chart",
          "View transaction history (calls, top-ups, refunds)",
          "Click Top Up to add credits via Stripe",
          "Set auto-recharge threshold",
          "Download transaction statements"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "/api/wallet"
          },
          {
            "method": "GET",
            "endpoint": "/api/wallet/transactions"
          },
          {
            "method": "POST",
            "endpoint": "/api/wallet/topup"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Phone Settings",
        "description": "Manage inbound and outbound phone numbers, configure AI forwarding, verify caller IDs",
        "files": [
          "src/app/dashboard/phone-settings/page.tsx",
          "src/components/dashboard/BuyNumberModal.tsx"
        ],
        "entry_route": "/dashboard/phone-settings",
        "user_interactions": [
          "Buy new phone number for inbound calls",
          "Set up AI forwarding (total AI or safety net mode)",
          "Configure forwarding ring time",
          "Add outbound caller ID for verification",
          "View verification status",
          "Delete phone numbers"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "/api/phone-settings/status"
          },
          {
            "method": "POST",
            "endpoint": "/api/phone-settings/buy-number"
          },
          {
            "method": "POST",
            "endpoint": "/api/verified-caller-id/verify"
          },
          {
            "method": "POST",
            "endpoint": "/api/verified-caller-id/confirm"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Test Agent",
        "description": "Test AI agent with web text interface or browser-based voice call",
        "files": [
          "src/app/dashboard/test/page.tsx",
          "src/contexts/VoiceAgentContext.tsx",
          "src/components/voice/VoiceControls.tsx"
        ],
        "entry_route": "/dashboard/test",
        "user_interactions": [
          "Type message to test agent text response",
          "Click microphone to start voice test",
          "See real-time transcript during call",
          "View agent response quality",
          "Stop test call"
        ],
        "api_calls": [
          {
            "method": "POST",
            "endpoint": "/api/test-call"
          },
          {
            "method": "POST",
            "endpoint": "/api/chat"
          }
        ],
        "auth_required": true
      }
    ],
    "known_limitations": [
      {
        "issue": "Call escalation feature not fully implemented",
        "location": "src/app/dashboard/escalation-rules/page.tsx",
        "impact": "Escalation rules page exists but backend workflows not connected"
      },
      {
        "issue": "Hybrid telephony deployment pending",
        "location": "src/app/dashboard/phone-settings/page.tsx",
        "impact": "AI forwarding feature complete but not fully deployed to production"
      },
      {
        "issue": "Multi-language support not available",
        "location": "Global",
        "impact": "Platform only supports English language interface and AI responses"
      }
    ]
  }
}
