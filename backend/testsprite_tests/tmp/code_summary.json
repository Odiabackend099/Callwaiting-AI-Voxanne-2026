{
  "tech_stack": [
    "TypeScript",
    "Node.js",
    "Express",
    "Supabase",
    "Vapi",
    "Groq",
    "Jest",
    "WebSocket"
  ],
  "features": [
    {
      "name": "Webhooks API",
      "description": "Handles incoming webhooks from Vapi for call events (started, ended, transcript, recording).",
      "files": [
        "src/routes/webhooks.ts",
        "src/routes/vapi-webhook.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/webhooks/vapi": {
            "post": {
              "summary": "Receive Vapi webhooks",
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "required": ["message"],
                      "properties": {
                        "message": {
                          "type": "object",
                          "required": ["type", "call"],
                          "properties": {
                            "type": { "type": "string", "enum": ["call.started", "call.ended", "call.transcribed", "end-of-call-report", "function-call"] },
                            "call": {
                              "type": "object",
                              "required": ["id", "status"],
                              "properties": {
                                "id": { "type": "string", "minLength": 1 },
                                "status": { "type": "string" },
                                "assistantId": { "type": "string" },
                                "customer": {
                                  "type": "object",
                                  "properties": {
                                    "number": { "type": "string" }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              },
              "responses": {
                "200": { "description": "Webhook processed successfully" }
              }
            }
          }
        }
      }
    },
    {
      "name": "Calls API",
      "description": "Endpoints to manage outbound calls and retrieve call logs.",
      "files": [
        "src/routes/calls.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/calls/start": {
            "post": {
              "summary": "Start bulk outbound calls",
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "required": ["leads", "vapiAgentId", "selectedVoice"],
                      "properties": {
                        "leads": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "required": ["id", "phone"],
                            "properties": {
                              "id": { "type": "string" },
                              "phone": { "type": "string" },
                              "name": { "type": "string" }
                            }
                          }
                        },
                        "vapiAgentId": { "type": "string" },
                        "selectedVoice": { "type": "string" }
                      }
                    }
                  }
                }
              },
              "responses": {
                "200": { "description": "Calls started" }
              }
            }
          },
          "/api/calls": {
            "get": {
              "summary": "Get call logs",
              "responses": {
                "200": { "description": "List of call logs" }
              }
            }
          },
          "/api/calls/{callId}": {
            "get": {
              "summary": "Get call details",
              "parameters": [
                { "name": "callId", "in": "path", "required": true, "schema": { "type": "string" } }
              ],
              "responses": {
                "200": { "description": "Call details" }
              }
            }
          },
          "/api/calls/{callId}/recording": {
            "get": {
              "summary": "Get call recording URL",
              "parameters": [
                { "name": "callId", "in": "path", "required": true, "schema": { "type": "string" } }
              ],
              "responses": {
                "200": { "description": "Recording URL" }
              }
            }
          }
        }
      }
    },
    {
      "name": "Assistants API",
      "description": "Manage Vapi assistants (list, sync).",
      "files": [
        "src/routes/assistants.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/assistants": {
            "get": {
              "summary": "List assistants from Vapi",
              "responses": {
                "200": { "description": "List of assistants" },
                "503": { "description": "Vapi not configured (missing VAPI_API_KEY)" }
              }
            }
          },
          "/api/assistants/{agentId}/sync": {
            "post": {
              "summary": "Sync agent to Vapi assistant",
              "parameters": [
                { "name": "agentId", "in": "path", "required": true, "schema": { "type": "string" } }
              ],
              "responses": {
                "200": { "description": "Assistant synced" }
              }
            }
          }
        }
      }
    },
    {
      "name": "Knowledge Base API",
      "description": "Upload documents and query the knowledge base (RAG).",
      "files": [
        "src/routes/knowledge-base.ts",
        "src/routes/knowledge-base-rag.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/knowledge-base": {
            "get": {
              "summary": "List KB documents",
              "responses": {
                "200": { "description": "List of documents" }
              }
            },
            "post": {
              "summary": "Create KB document",
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "required": ["name", "content"],
                      "properties": {
                        "name": { "type": "string" },
                        "content": { "type": "string" },
                        "category": { "type": "string", "enum": ["products_services", "operations", "ai_guidelines", "general"] }
                      }
                    }
                  }
                }
              },
              "responses": {
                "200": { "description": "Document created" }
              }
            }
          },
          "/api/knowledge-base/search": {
            "post": {
              "summary": "Search knowledge base using vector similarity",
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "required": ["query"],
                      "properties": {
                        "query": { "type": "string" }
                      }
                    }
                  }
                }
              },
              "responses": {
                "200": { "description": "Search results" }
              }
            }
          },
          "/api/knowledge-base/{id}/chunks": {
            "get": {
              "summary": "Get chunks for a document",
              "parameters": [
                { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } }
              ],
              "responses": {
                "200": { "description": "Document chunks" }
              }
            }
          }
        }
      }
    },
    {
      "name": "Vapi Setup API",
      "description": "Setup Vapi integration and webhooks.",
      "files": [
        "src/routes/vapi-setup.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/vapi/setup/configure-webhook": {
            "post": {
              "summary": "Configure Vapi assistant with RAG webhook",
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "assistantId": { "type": "string" }
                      }
                    }
                  }
                }
              },
              "responses": {
                "200": { "description": "Webhook configured" }
              }
            }
          },
          "/api/vapi/setup/status": {
            "get": {
              "summary": "Check Vapi webhook configuration status",
              "responses": {
                "200": { "description": "Configuration status" }
              }
            }
          }
        }
      }
    },
    {
      "name": "Inbound Setup API",
      "description": "Configure inbound call handling with Twilio and Vapi.",
      "files": [
        "src/routes/inbound-setup.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/inbound/setup": {
            "post": {
              "summary": "Configure Twilio credentials and link to Vapi inbound assistant",
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "required": ["twilioAccountSid", "twilioAuthToken", "twilioPhoneNumber"],
                      "properties": {
                        "twilioAccountSid": { "type": "string" },
                        "twilioAuthToken": { "type": "string" },
                        "twilioPhoneNumber": { "type": "string" }
                      }
                    }
                  }
                }
              },
              "responses": {
                "200": { "description": "Inbound setup complete" }
              }
            }
          },
          "/api/inbound/status": {
            "get": {
              "summary": "Get current inbound configuration status",
              "responses": {
                "200": { "description": "Inbound status" }
              }
            }
          },
          "/api/inbound/test": {
            "post": {
              "summary": "Test inbound setup by making a test call",
              "responses": {
                "200": { "description": "Test initiated" }
              }
            }
          }
        }
      }
    },
    {
      "name": "Founder Console Settings API",
      "description": "Manage settings for the founder console.",
      "files": [
        "src/routes/founder-console-settings.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/founder-console/settings": {
            "get": {
              "summary": "Get settings",
              "responses": {
                "200": { "description": "Settings retrieved" }
              }
            },
            "post": {
              "summary": "Save settings",
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "vapi_api_key": { "type": "string" },
                        "twilio_account_sid": { "type": "string" },
                        "twilio_auth_token": { "type": "string" }
                      }
                    }
                  }
                }
              },
              "responses": {
                "200": { "description": "Settings saved" }
              }
            }
          }
        }
      }
    }
  ]
}
