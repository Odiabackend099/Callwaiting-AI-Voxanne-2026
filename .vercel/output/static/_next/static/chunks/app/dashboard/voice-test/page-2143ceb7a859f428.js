(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5839],{6385:(e,t,s)=>{"use strict";s.d(t,{N:()=>i});var n=s(3318);let a=null,i=a=(0,n.createBrowserClient)("https://lbjymlodxprzqgtyqtcq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxianltbG9keHByenFndHlxdGNxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzNDk1MzEsImV4cCI6MjA3ODkyNTUzMX0.m9k-Id03Kt1scFWvIuK354EHjiO0Y-d8mbO53QqSMRU")},7254:(e,t,s)=>{Promise.resolve().then(s.bind(s,7271))},7271:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>w});var n=s(5155),a=s(2115),i=s(642),r=s(4817),o=s(3321),l=s(723),c=s(3545),d=s(4643),u=s(6909),h=s(5118),x=s(4217),m=s(2186);class p{constructor(e){this.audioContext=null,this.mediaStream=null,this.sourceNode=null,this.processorNode=null,this.isRecording=!1,this.chunkCount=0,this.ws=e}async start(){console.log("\uD83C\uDFA4 Starting audio capture...");try{this.mediaStream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3}}),this.audioContext=new AudioContext({sampleRate:16e3}),console.log(`‚úÖ Audio Context: ${this.audioContext.sampleRate}Hz`),this.sourceNode=this.audioContext.createMediaStreamSource(this.mediaStream),this.processorNode=this.audioContext.createScriptProcessor(4096,1,1),this.processorNode.connect(this.audioContext.destination),this.processorNode.onaudioprocess=e=>{if(!this.isRecording||this.ws.readyState!==WebSocket.OPEN)return;let t=e.inputBuffer.getChannelData(0),s=this.float32ToInt16(t);this.ws.send(s.buffer),this.chunkCount++},this.sourceNode.connect(this.processorNode),this.isRecording=!0,this.chunkCount=0,console.log("‚úÖ Recording started (16kHz PCM16)")}catch(e){throw console.error("‚ùå Failed to start recording:",e),e}}float32ToInt16(e){let t=new Int16Array(e.length);for(let s=0;s<e.length;s++){let n=Math.max(-1,Math.min(1,e[s]));t[s]=n<0?32768*n:32767*n}return t}stop(){console.log(`üé§ Stopping recording (${this.chunkCount} chunks sent)...`),this.isRecording=!1,this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=null),this.processorNode&&(this.processorNode.disconnect(),this.processorNode=null),this.mediaStream&&(this.mediaStream.getTracks().forEach(e=>e.stop()),this.mediaStream=null),this.audioContext&&(this.audioContext.close(),this.audioContext=null),console.log("‚úÖ Recording stopped")}isActive(){return this.isRecording}}class g{constructor(){this.audioContext=null,this.gainNode=null,this.audioQueue=[],this.isPlaying=!1,this.currentSource=null,this.nextStartTime=0}async ensureContext(){return this.audioContext||(this.audioContext=new AudioContext({sampleRate:24e3}),this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination),console.log(`‚úÖ Audio Player: ${this.audioContext.sampleRate}Hz`)),"suspended"===this.audioContext.state&&await this.audioContext.resume(),this.audioContext}async playChunk(e){try{let t=await this.ensureContext(),s=await t.decodeAudioData(e.slice(0));this.audioQueue.push(s),this.isPlaying||this.scheduleNext()}catch(e){console.warn("Audio decode error:",e)}}scheduleNext(){if(0===this.audioQueue.length){this.isPlaying=!1,this.nextStartTime=0;return}if(!this.audioContext||!this.gainNode)return;this.isPlaying=!0;let e=this.audioQueue.shift(),t=this.audioContext.createBufferSource();t.buffer=e,t.connect(this.gainNode);let s=Math.max(this.audioContext.currentTime,this.nextStartTime);t.start(s),this.nextStartTime=s+e.duration,this.currentSource=t,t.onended=()=>{this.currentSource=null,this.scheduleNext()}}stop(){if(this.currentSource){try{this.currentSource.stop()}catch(e){}this.currentSource=null}this.audioQueue=[],this.isPlaying=!1,this.nextStartTime=0}getIsPlaying(){return this.isPlaying}async close(){this.stop(),this.audioContext&&(await this.audioContext.close(),this.audioContext=null)}}var f=s(6385);function w(){let e=(0,o.useRouter)(),[t,s]=(0,a.useState)(!1),[w,b]=(0,a.useState)(!1),{isConnected:y,isRecording:N,isSpeaking:j,transcripts:k,error:C,connect:v,disconnect:S,startRecording:R,stopRecording:A}=function(e={}){let[t,s]=(0,a.useState)({isConnected:!1,isRecording:!1,isSpeaking:!1,transcripts:[],error:null,session:null}),n=(0,a.useRef)(null),i=(0,a.useRef)(null),r=(0,a.useRef)(null),o=(0,a.useRef)(`session_${Date.now()}_${Math.random().toString(36).substring(7)}`),l=(0,a.useRef)(null),c=(0,a.useRef)(0),d=(0,a.useRef)(0),u=(0,a.useCallback)(()=>{let e="localhost:8000",t=e.startsWith("localhost")||e.startsWith("127.0.0.1");return`${t?"ws:":"wss:"}//${e}/ws/web-client`},[]),h=(0,a.useCallback)(async()=>{try{let{data:{session:e},error:t}=await f.N.auth.getSession();if(t)return console.error("Failed to get Supabase session:",t),null;return e?.access_token||null}catch(e){return console.error("Error getting auth token:",e),null}},[]),x=(0,a.useCallback)(async()=>{try{s(e=>({...e,error:null,isConnected:!1}));let t=await h(),a=`${u()}?sessionId=${o.current}`;t?(a+=`&token=${t}`,console.log("\uD83D\uDD0C Connecting to WebSocket:",a.replace(t,"TOKEN"))):console.log("\uD83D\uDD0C Connecting to WebSocket (no auth):",a);let i=new WebSocket(a);n.current=i,i.onopen=()=>{console.log("‚úÖ WebSocket connected"),c.current=0,s(e=>({...e,isConnected:!0,session:{id:o.current,sessionId:o.current,status:"connected",startedAt:new Date,totalMessages:0}})),e.onConnected?.()},i.onmessage=async t=>{try{if(t.data instanceof Blob){let e=await t.data.arrayBuffer();r.current&&e.byteLength>0&&(await r.current.playChunk(e),s(e=>({...e,isSpeaking:!0})),setTimeout(()=>{s(e=>({...e,isSpeaking:!1}))},1e3));return}if(t.data instanceof ArrayBuffer){r.current&&t.data.byteLength>0&&(await r.current.playChunk(t.data),s(e=>({...e,isSpeaking:!0})),setTimeout(()=>{s(e=>({...e,isSpeaking:!1}))},1e3));return}let n=JSON.parse(t.data);switch(console.log("\uD83D\uDCE8 WebSocket message:",n.type),n.type){case"connected":console.log("\uD83C\uDF89 Agent ready:",n.message);break;case"transcript":n.text&&n.is_final&&s(e=>{let t=e.transcripts[e.transcripts.length-1];if(t&&t.text===n.text&&t.speaker===(n.speaker||"user")&&new Date().getTime()-t.timestamp.getTime()<1e3)return e;let s={id:`${Date.now()}_${Math.random()}`,speaker:n.speaker||"user",text:n.text||"",confidence:n.confidence,isFinal:!0,timestamp:new Date};return{...e,transcripts:[...e.transcripts,s],session:e.session?{...e.session,totalMessages:e.session.totalMessages+1}:null}});break;case"response":if(n.text){let e={id:`${Date.now()}_${Math.random()}`,speaker:"agent",text:n.text||"",confidence:n.confidence,isFinal:!0,timestamp:new Date};s(t=>({...t,transcripts:[...t.transcripts,e],isSpeaking:!0,session:t.session?{...t.session,totalMessages:t.session.totalMessages+1}:null}))}break;case"audio":if(n.audio&&r.current){let e=Uint8Array.from(atob(n.audio),e=>e.charCodeAt(0));await r.current.playChunk(e.buffer),s(e=>({...e,isSpeaking:!0}))}break;case"state":let{to:a}=n;"SPEAKING"===a?s(e=>({...e,isSpeaking:!0})):("LISTENING"===a||"IDLE"===a)&&s(e=>({...e,isSpeaking:!1}));break;case"error":console.error("‚ùå Server error:",n.error||n.message),s(e=>({...e,error:n.error||n.message||"Unknown error"})),e.onError?.(n.error||n.message||"Unknown error");break;case"interrupt":console.log("\uD83D\uDD07 Agent interrupted"),r.current?.stop(),s(e=>({...e,isSpeaking:!1}))}}catch(e){console.error("Failed to parse WebSocket message:",e)}},i.onerror=e=>{console.error("‚ùå WebSocket error:",e),s(e=>({...e,error:"Connection error occurred"}))},i.onclose=t=>{console.log("\uD83D\uDD0C WebSocket closed:",t.code,t.reason),console.log(`   üìä Sent ${d.current} audio chunks before closing`),s(e=>({...e,isConnected:!1,isRecording:!1,session:e.session?{...e.session,status:"disconnected",endedAt:new Date}:null})),n.current=null,e.onDisconnected?.(),c.current<5&&1e3!==t.code&&(c.current++,console.log(`üîÑ Reconnecting... (attempt ${c.current}/5)`),l.current=setTimeout(()=>{x()},2e3))}}catch(n){console.error("Failed to connect:",n);let t=n instanceof Error?n.message:"Unknown error";s(e=>({...e,error:t})),e.onError?.(t)}},[u,h,e]),m=(0,a.useCallback)(async()=>{try{if(!n.current||n.current.readyState!==WebSocket.OPEN)throw Error("Not connected to server");r.current||(r.current=new g),d.current=0;let e=new p(n.current);await e.start(),i.current=e,s(e=>({...e,isRecording:!0})),console.log("\uD83C\uDFA4 Recording started")}catch(n){console.error("Failed to start recording:",n);let t=n instanceof Error?n.message:"Unknown error";s(e=>({...e,error:t})),e.onError?.(t)}},[e]),w=(0,a.useCallback)(()=>{i.current&&(i.current.stop(),i.current=null),s(e=>({...e,isRecording:!1})),console.log("\uD83C\uDFA4 Recording stopped")},[]),b=(0,a.useCallback)(()=>{l.current&&(clearTimeout(l.current),l.current=null),w(),r.current&&(r.current.close(),r.current=null),n.current&&(n.current.close(1e3,"User disconnected"),n.current=null),s(e=>({...e,isConnected:!1,session:e.session?{...e.session,status:"disconnected",endedAt:new Date,durationSeconds:Math.floor((new Date().getTime()-e.session.startedAt.getTime())/1e3)}:null}))},[w]);return(0,a.useEffect)(()=>()=>{b()},[b]),{...t,connect:x,disconnect:b,startRecording:m,stopRecording:w}}({onConnected:()=>{console.log("‚úÖ Connected to voice agent"),b(!1)},onDisconnected:()=>{console.log("\uD83D\uDD0C Disconnected from voice agent"),s(!1),b(!1)},onError:e=>{console.error("‚ùå Voice agent error:",e),b(!1)}}),I=async()=>{try{b(!0),await v(),s(!0),setTimeout(async()=>{await R()},500)}catch(e){console.error("Failed to start call:",e),b(!1)}},P=async()=>{N?A():await R()};return(0,n.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900/20 to-slate-900",children:[(0,n.jsx)("header",{className:"fixed top-0 left-0 right-0 z-50 bg-slate-900/80 backdrop-blur-xl border-b border-white/5",children:(0,n.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-4 flex items-center justify-between",children:[(0,n.jsxs)("button",{onClick:()=>e.push("/dashboard"),className:"flex items-center gap-2 text-slate-400 hover:text-white transition-colors",children:[(0,n.jsx)(l.A,{className:"w-5 h-5"}),(0,n.jsx)("span",{className:"text-sm font-medium",children:"Back"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-white text-sm font-bold",children:"R"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-white font-semibold",children:"Roxanne AI"}),(0,n.jsx)("p",{className:"text-xs text-slate-400",children:"Voice Assistant"})]})]}),(0,n.jsx)("div",{className:"w-16"})," "]})}),(0,n.jsxs)("main",{className:"pt-24 pb-40 px-4 max-w-4xl mx-auto",children:[(0,n.jsx)(i.N,{children:C&&(0,n.jsx)(r.P.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mb-6",children:(0,n.jsxs)("div",{className:"bg-red-500/10 border border-red-500/30 rounded-2xl p-4 flex items-center gap-3",children:[(0,n.jsx)(c.A,{className:"w-5 h-5 text-red-400 flex-shrink-0"}),(0,n.jsx)("p",{className:"text-red-300 text-sm",children:C})]})})}),(0,n.jsx)("div",{className:"min-h-[60vh] flex flex-col",children:0===k.length?(0,n.jsxs)(r.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex-1 flex flex-col items-center justify-center text-center py-20",children:[(0,n.jsxs)(r.P.div,{className:`relative mb-8 ${t&&j?"animate-pulse":""}`,children:[(0,n.jsx)("div",{className:"w-32 h-32 rounded-full bg-gradient-to-br from-violet-500 via-purple-500 to-fuchsia-500 flex items-center justify-center shadow-2xl shadow-purple-500/30",children:(0,n.jsx)("span",{className:"text-white text-5xl font-bold",children:"R"})}),t&&(0,n.jsx)(r.P.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"absolute -bottom-2 -right-2 w-10 h-10 rounded-full bg-green-500 flex items-center justify-center border-4 border-slate-900",children:j?(0,n.jsx)(d.A,{className:"w-5 h-5 text-white animate-pulse"}):N?(0,n.jsx)(u.A,{className:"w-5 h-5 text-white"}):(0,n.jsx)(h.A,{className:"w-4 h-4 text-white"})})]}),(0,n.jsx)("h2",{className:"text-2xl font-bold text-white mb-3",children:t?j?"Roxanne is speaking...":N?"Listening...":"Connected":"Talk to Roxanne"}),(0,n.jsx)("p",{className:"text-slate-400 max-w-md",children:t?"Speak naturally. Roxanne will respond in real-time.":"Experience our AI voice receptionist. Click below to start a conversation."}),!t&&(0,n.jsx)("div",{className:"mt-10 grid grid-cols-1 sm:grid-cols-3 gap-4 w-full max-w-lg",children:[{icon:"\uD83C\uDFAF",title:"Natural Speech",desc:"Just talk normally"},{icon:"‚ö°",title:"Real-time",desc:"Instant responses"},{icon:"\uD83D\uDD12",title:"Private",desc:"Secure connection"}].map((e,t)=>(0,n.jsxs)(r.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"bg-white/5 rounded-2xl p-4 text-center border border-white/5",children:[(0,n.jsx)("div",{className:"text-2xl mb-2",children:e.icon}),(0,n.jsx)("div",{className:"text-white font-medium text-sm",children:e.title}),(0,n.jsx)("div",{className:"text-slate-500 text-xs",children:e.desc})]},t))})]}):(0,n.jsxs)("div",{className:"space-y-4 py-4",children:[k.map((e,t)=>(0,n.jsx)(r.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${"agent"===e.speaker?"justify-start":"justify-end"}`,children:(0,n.jsxs)("div",{className:`max-w-[80%] rounded-2xl px-5 py-3 ${"agent"===e.speaker?"bg-gradient-to-br from-violet-600/80 to-purple-600/80 text-white":"bg-white/10 text-white border border-white/10"}`,children:[(0,n.jsx)("p",{className:"text-sm leading-relaxed",children:e.text}),(0,n.jsx)("p",{className:`text-xs mt-1 ${"agent"===e.speaker?"text-violet-200":"text-slate-500"}`,children:"agent"===e.speaker?"Roxanne":"You"})]})},e.id||t)),j&&(0,n.jsx)(r.P.div,{initial:{opacity:0},animate:{opacity:1},className:"flex justify-start",children:(0,n.jsxs)("div",{className:"bg-violet-600/50 rounded-2xl px-5 py-3 flex items-center gap-2",children:[(0,n.jsxs)("div",{className:"flex gap-1",children:[(0,n.jsx)("span",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,n.jsx)("span",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,n.jsx)("span",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),(0,n.jsx)("span",{className:"text-violet-200 text-sm",children:"Roxanne is speaking..."})]})})]})})]}),(0,n.jsx)("div",{className:"fixed bottom-0 left-0 right-0 bg-gradient-to-t from-slate-900 via-slate-900/95 to-transparent pt-10 pb-8 px-4",children:(0,n.jsxs)("div",{className:"max-w-md mx-auto",children:[t?(0,n.jsxs)(r.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex items-center justify-center gap-6",children:[(0,n.jsx)("button",{onClick:P,className:`w-16 h-16 rounded-full flex items-center justify-center transition-all ${N?"bg-white/10 text-white hover:bg-white/20":"bg-red-500/20 text-red-400 hover:bg-red-500/30"}`,children:N?(0,n.jsx)(u.A,{className:"w-7 h-7"}):(0,n.jsx)(x.A,{className:"w-7 h-7"})}),(0,n.jsx)("button",{onClick:()=>{A(),S(),s(!1)},className:"w-20 h-20 rounded-full bg-red-500 hover:bg-red-600 text-white flex items-center justify-center shadow-2xl shadow-red-500/30 hover:scale-105 transition-all",children:(0,n.jsx)(m.A,{className:"w-8 h-8"})}),(0,n.jsx)("div",{className:`w-16 h-16 rounded-full flex items-center justify-center ${j?"bg-green-500/20 text-green-400":"bg-white/5 text-slate-500"}`,children:(0,n.jsx)(d.A,{className:`w-7 h-7 ${j?"animate-pulse":""}`})})]}):(0,n.jsxs)(r.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center",children:[(0,n.jsxs)("button",{onClick:I,disabled:w,className:"group relative inline-flex items-center justify-center gap-3 px-10 py-5 bg-gradient-to-r from-violet-600 to-purple-600 text-white rounded-full font-semibold text-lg shadow-2xl shadow-purple-500/30 hover:shadow-purple-500/50 hover:scale-105 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:[w?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Connecting..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(h.A,{className:"w-5 h-5"}),"Start Conversation"]}),(0,n.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-r from-violet-600 to-purple-600 blur-xl opacity-50 group-hover:opacity-75 transition-opacity -z-10"})]}),(0,n.jsx)("p",{className:"mt-4 text-slate-500 text-sm",children:"Click to start talking with Roxanne"})]}),t&&(0,n.jsx)(r.P.div,{initial:{opacity:0},animate:{opacity:1},className:"mt-4 text-center",children:(0,n.jsxs)("div",{className:"inline-flex items-center gap-2 text-sm",children:[(0,n.jsx)("span",{className:`w-2 h-2 rounded-full ${y?"bg-green-500":"bg-yellow-500 animate-pulse"}`}),(0,n.jsx)("span",{className:"text-slate-400",children:y?"Connected":"Reconnecting..."})]})})]})})]})}}},e=>{e.O(0,[5946,8346,6980,8441,8928,7358],()=>e(e.s=7254)),_N_E=e.O()}]);